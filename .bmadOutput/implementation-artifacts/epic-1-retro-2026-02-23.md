# Rétrospective Épique 1 : Fondation du Projet et Configuration

**Date :** 2026-02-23
**Facilitateur :** Bob (Scrum Master)
**Participants :** Bob (SM), John (PM), Amelia (Dev), Winston (Architect), Quinn (QA), taieb (Project Lead)

## Résumé de l'Épique

- **Stories livrées :** 3/3 (100%)
  - Story 1.1 : Initialisation du Projet Worker Service
  - Story 1.2 : Configuration et Injection de Dépendances
  - Story 1.3 : Déploiement VPS et Service systemd
- **Tests :** 11 passent, 0 régression
- **Issues review :** 22 identifiés, 20 corrigés, 2 Low en suivi
- **Agents dev :** claude-sonnet-4-6 (implémentation), claude-opus-4-6 + claude-sonnet-4-6 (reviews)

## Ce qui a bien marché

### 1. Reviews adversariales — quality gate efficace
22 issues identifiés en 3 stories, dont des failles sécurité critiques (credentials en clair, service root, launchSettings non gitignored). Sans ce gate, le code aurait été déployé avec des vulnérabilités. Le pattern review adversariale est le meilleur investissement de l'épique.

### 2. Planification architecture détaillée
Le document d'architecture couvrait 23 FRs et 12 NFRs avec des patterns d'implémentation précis. Résultat : 0 blocage, 0 retour en arrière, les 3 stories se sont enchaînées sans ambiguïté.

### 3. Progression des tests
De 1 test placeholder (story 1.1) à 11 tests réels (story 1.2), tous verts. Le pipeline CI GitHub Actions (story 1.3) protège désormais chaque push/PR.

### 4. Breakthrough submodule
Le `ProjectReference` standard vers le submodule Exe fonctionne sans conflit. On avait anticipé 3 solutions de contournement, la plus simple marchait. Cela simplifie l'architecture pour toute la suite du projet.

## Ce qui peut s'améliorer

### 1. Lacunes sécurité récurrentes du dev agent (3/3 stories)
Pattern constant :
- Story 1.1 : `launchSettings.json` non gitignored (credentials potentielles)
- Story 1.2 : `Password`/`BotToken` inclus dans `appsettings.json`
- Story 1.3 : Service systemd en root, pas de hardening, chemin `dotnet` non-absolu

Le dev agent (claude-sonnet-4-6) est solide sur le core fonctionnel mais manque systématiquement les aspects sécurité et hardening.

### 2. Documentation File List parfois incomplète
Sprint-status.yaml modifié mais non documenté dans la File List de story 1.3. Les File Lists doivent refléter TOUS les fichiers modifiés.

### 3. Gotcha .NET 9
`HostApplicationBuilder` n'expose pas `.Host` — il faut utiliser `builder.Services.AddSystemd()` au lieu de `builder.Host.UseSystemd()`. Temps perdu à comprendre cette subtilité API.

## Leçons clés

1. **Les reviews adversariales sont indispensables** — 22 issues sur 3 stories, dont des failles critiques
2. **La planification architecture accélère l'implémentation** — 0 blocage quand le doc est complet
3. **Le dev agent a un angle mort sécurité** — nécessite un checklist explicite par story
4. **ProjectReference standard vers submodule Exe = pas de conflit** — simplifie l'intégration

## Action Items

### Améliorations processus

| # | Action | Owner | Deadline | Critère de succès |
|---|---|---|---|---|
| 1 | Ajouter un checklist sécurité dans les Dev Notes de chaque story | Bob (SM) | Story 2.1 | Chaque story inclut "Security Checklist" |
| 2 | Maintenir review adversariale avec modèle différent du dev agent | taieb (PL) | Continu | Chaque review utilise un LLM distinct |

### Dette technique

| # | Item | Owner | Priorité | Notes |
|---|---|---|---|---|
| 1 | Worker.cs logge toutes les secondes | Amelia (Dev) | Low | Résolu quand SchedulerWorker le remplace (Épique 5) |
| 2 | Configs x64/x86 inutiles dans .sln | Amelia (Dev) | Low | Cosmétique, pas d'impact |

### Accords d'équipe

- Le dev agent DOIT vérifier : pas de credentials en clair, pas de service en root, hardening systemd, paths absolus
- Toute story touchant aux credentials ou à l'infrastructure doit avoir une review adversariale
- Les File Lists doivent inclure TOUS les fichiers modifiés (y compris sprint-status.yaml)

## Préparation Épique 2

### Prérequis techniques
- [ ] Spike API : valider endpoints `upcoming bets` et `publish` sur bet2invest (story 2.1)
- [ ] Comprendre le pattern `IConsoleLogger` du scraper pour l'adapter à `ILogger<T>` (story 2.1)

### Dépendances sur Épique 1
- `Bet2InvestClient` du submodule (story 1.1) ✅
- `IOptions<Bet2InvestOptions>` + credentials via env vars (story 1.2) ✅
- Serilog structuré avec `{Step}` (story 1.2) ✅
- CI GitHub Actions (story 1.3) ✅

### Évaluation : PRÊT
Aucun blocage critique. Toutes les fondations sont solides.

## Readiness Assessment

| Dimension | Status | Notes |
|---|---|---|
| Tests & Qualité | ✅ | 11/11 tests, 0 régression, 20/22 issues fixés |
| Déploiement | ⚠️ | Non déployé (infra prête, déploiement réel post-MVP) |
| Santé technique | ✅ | Build clean, 0 warning, architecture respectée |
| Blocages | ✅ | Aucun (2 Low n'impactent pas Épique 2) |
